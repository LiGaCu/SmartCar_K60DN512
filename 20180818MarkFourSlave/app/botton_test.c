#include "common.h"
#include "botton_test.h"
#include "camera.h"
#include "oled.h"
#include "myflash.h"

void botton_init_gpio(void)
{  
  static GPIO_InitTypeDef botton_gpio_init;
  botton_gpio_init.GPIO_PTx = PTE;
  botton_gpio_init.GPIO_Pins = GPIO_Pin24|GPIO_Pin25|GPIO_Pin26|GPIO_Pin27;
  botton_gpio_init.GPIO_Dir = DIR_INPUT;
  botton_gpio_init.GPIO_PinControl =INPUT_PULL_UP;
  LPLD_GPIO_Init(botton_gpio_init);
}
void Key_delay()
{
	uint16 i, n;
	for (i = 0; i < 19000; i++)
	{
		for (n = 0; n < 50; n++)
		{
			asm("nop");
		}
	}
}
unsigned char KeyScan(void)
{
  if (PTE24_I == 0)
  {
    Key_delay();
    if (PTE24_I == 0)
    {
      return 1;
    }
  }
  else if (PTE25_I == 0)//6
  {
    Key_delay();
    if (PTE25_I == 0)
    {
      return 2;
    }
  }
  else if (PTE26_I == 0)//6
  {
    Key_delay();
    if (PTE26_I == 0)
    {
      return 3;
    }
  }
  
  else if (PTE27_I == 0)//1
  {
    Key_delay();
    if (PTE27_I == 0)
    {
      return 4;
    }
  }
  return 10;
}
/*------------------------吃火锅专用-----------------------------------*/
const unsigned char LoveHotpot[][60] = 
{
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x40,0x20,0x30,0x30,0x30,0x1C,0x0C,0x0E,0x0E,0x0E,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02},
  {0x02,0x02,0x0E,0x0C,0x0C,0x0C,0x0C,0x3C,0x3C,0x30,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xE0,0xF0,0xFE,0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF1,0xF1,0xF1,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xE0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0xE0,0xE0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x07,0x07,0x07,0x1E,0x70,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x1F,0x1F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80},
  {0x80,0x80,0x81,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x3B,0x60,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xFF,0x1F,0x07,0x03,0x01,0x01,0x0F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x0F,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x01,0x01,0x01,0x03,0x07,0x08,0x08,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x7F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xF8,0xF8,0xF8,0xF8,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0x00,0x00,0x01,0x01,0x03,0x06,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
  {0x04,0x04,0x04,0x04,0x04,0x04,0x06,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x70,0x7C,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x00,0x40,0x44,0x64,0x24,0x14,0x1C,0x7C,0x0C,0x14,0x24,0x24,0x44,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0x18,0x80,0x60,0x38,0x20,0xA0,0x20,0x20,0xA0,0x60,0x00,0xE8,0x28,0x28,0xF8,0x28,0x28,0x28,0xF8,0x28,0x28,0xE8,0x00,0x00,0x08,0x08,0x08,0x08,0x88,0xF8,0x98,0x08,0x08,0x08,0x08},
  {0x08,0x00,0xE8,0x28,0x28,0x28,0xF8,0x28,0x28,0xF8,0x28,0x28,0xE8,0x00,0x00,0xF0,0x10,0x70,0x80,0xC0,0x30,0x28,0x20,0x20,0x20,0x20,0x00,0x00,0x20,0x40,0x80,0x00,0x00,0xF8,0x00,0x00,0x80,0x40,0x20,0x80,0xC0,0xB0,0xA8,0xA0,0x20,0x78,0x48,0x48,0xC8,0x48,0x48,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x00,0x40,0x41,0x41,0x79,0x41,0x41,0x7F,0x49,0x49,0x49,0x49,0x41,0x40,0x00,0x00,0x00,0x30,0x70,0x00,0x01,0x01,0x7F,0x00,0x08,0x04,0x42,0x40,0x7F,0x00,0x02,0x04,0x08,0x04,0x45,0x45,0x5D,0x57,0x35,0x25,0x35,0x35,0x2D,0x45,0x45,0x04,0x10,0x08,0x04,0x02,0x01,0x00,0x7F,0x00,0x01,0x02,0x04,0x04},
  {0x08,0x04,0x45,0x45,0x5D,0x57,0x35,0x25,0x35,0x35,0x2D,0x45,0x45,0x04,0x00,0x1F,0x08,0x0F,0x00,0x20,0x51,0x49,0x45,0x43,0x41,0x60,0x18,0x40,0x40,0x20,0x10,0x18,0x04,0x03,0x04,0x0C,0x18,0x20,0x40,0x40,0x04,0x44,0x7F,0x24,0x00,0x7E,0x12,0x0A,0x0F,0x4A,0x52,0x52,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};

//const unsigned char LoveHotpot[][60] = 
//{
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x40,0x20,0x20,0x10,0x10,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x02,0x02,0x02,0x02,0x02,0xE2,0x02,0x02,0x02},
//  {0x02,0x02,0x04,0x04,0x04,0x04,0x08,0x08,0x08,0x10,0x10,0x20,0x20,0x40,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x20,0x18,0x04,0x02,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xFF,0xFF,0xFF,0xE0,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x02,0x0C,0x10,0x20,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x70,0x0E,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF8},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x0E,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0xE0,0xF0,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
//  {0xFF,0xF8,0xF0,0xE0,0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x0E,0x70,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xE0,0xF0,0xF8,0x7C,0x7E,0x3F,0x3F,0x3F,0x1F,0x1F,0x0F,0x0F,0x07,0x07,0x07,0x03,0x03,0x01,0x01,0x03},
//  {0x03,0x07,0x07,0x0F,0x0F,0x1F,0x1F,0x3F,0x3E,0x7C,0x78,0xF0,0xE0,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x70,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x04,0x18,0x20,0x42,0x83,0x83,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x83,0x83,0x46,0x20,0x18,0x04,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x04,0x04,0x08,0x08,0x10,0x10,0x10,0x20,0x20,0x20,0x20,0x20,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40},
//  {0x40,0x40,0x20,0x20,0x20,0x20,0x10,0x10,0x10,0x08,0x08,0x04,0x04,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
//};
void LED_Forfun_Image_120_56(const unsigned char *p)
{
  uint8 i,j;
  for(j=0;j<7;j++)
  {
      LED_Set_Pos(0,j);    
      for(i=0;i<120;i++)
      {     
              LED_WrDat(*(p+i+j*120));  
      }
  }
}

/*------------------------按键设置--------------------------------------*/
uint8 pagenum=1,lastpage;

void setting_process(void)
{
  if(PTE24_I==1&&PTE25_I==1&&PTE26_I==1&&PTE27_I==1)
  {
    if(lastpage!=pagenum) LED_Fill(0);
    if(pagenum==1)
    {
       dis_bmp_half(ROW/2, COLUMN/2, Image2[0],setvalue);
       LED_PrintValueC(100 ,0,Barrier_x);
       LED_PrintValueC(100 ,1,Barrier_y);
       LED_PrintValueFP(100 ,2,Validfiguresize,3);
       LED_PrintValueC(100 ,4,setvalue);
       LED_PrintValueI(42, 7, (int) Variance);
       LED_PrintValueC(0, 7, (int) Several_signal_y);
       display_BarrierLine_80_50(-1.2000,45);
       display_BarrierLine_80_50(0.9333,-106);
    }
    else if(pagenum==2)
    {
       dis_bmp_half_two(ROW_Two/2, COLUMN_Two/2, ImageTwo2[0],setvalue_Two);
       LED_PrintValueC(100 ,0,real_pointx);
       LED_PrintValueC(100 ,1,real_pointy);
       LED_PrintValueC(100 ,4,RealNopoint);
    }
    else
    {
      if(lastpage!=3)
      LED_Forfun_Image_120_56(LoveHotpot[0]);
    }
    lastpage=pagenum;
  }
  else
  {
    unsigned char temp = 10;//此初值表示没有按键按下
    temp = KeyScan();
    switch(temp)
    {
      case 1: if(pagenum==1) pagenum=2;
              else if(pagenum==2) pagenum=3;
              else if(pagenum==3) pagenum=1;
              LPLD_LPTMR_DelayMs(200);
              break;
      case 2: flash_config();
              LED_Fill(0);
              LED_P6x8Str(42, 3,(unsigned char*)"Done!");
              LPLD_LPTMR_DelayMs(1000);
              LED_Fill(0);
              break;
      case 4: if(pagenum==1) 
              {
                setvalue+=2;
                if(setvalue>250) setvalue=250;
              }
              LPLD_LPTMR_DelayMs(100);
              break;
      case 3: if(pagenum==1) 
              {
                setvalue-=2;
                if(setvalue<5) setvalue=5;
              }
              LPLD_LPTMR_DelayMs(100);
              break;
    }
  }
}